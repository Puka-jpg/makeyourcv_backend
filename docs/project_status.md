# Project Status: Agent-First Architecture Migration

**Last Updated:** January 23, 2026
**Status:** Phase 2 Complete (Agent Core & Interactive Logic)

## Overview
We have successfully migrated `makeyour.cv` to an **Agent-First Architecture**. The application is no longer just a CRUD form; it is now powered by an intelligent Agent that interacts with the user to build their resume dynamically.

## 1. Implemented Architecture

### A. The "Brain": Agent Server
*   **Location:** `agent/server.py`, `agent/factory.py`
*   **Tech:** Python, Google ADK (Agent Development Kit), FastAPI, WebSockets.
*   **Role:**
    *   Manages the conversation state using `InMemorySessionService` (currently per-session).
    *   Runs on **Port 8005**.
    *   Exposes a WebSocket endpoint: `ws://localhost:8005/ws/chat/{session_id}`.
    *   **Logic:** Implements a "Job Interview" workflow where the agent proactively asks for Job Descriptions and analyzes user profiles.

### B. The "Hands": MCP Server & Tools
*   **Location:** `backend/mcp_server.py`, `backend/tools/`
*   **Tech:** Model Context Protocol (MCP), Python.
*   **Role:** Exposes backend capabilities as "Tools" for the Agent.
*   **Implemented Tools:**
    1.  `parse_and_save_cv`: Parses uploaded PDFs using generic parsing logic and saves to the DB.
    2.  `get_user_profile_tool`: Fetches structured resume data from the database.
    3.  `generate_resume_pdf`: Generates a final PDF using **RenderCV** based on the user's data and selected theme.

### C. The "Face": Frontend Integration
*   **Location:** `frontend/makeyourcvfrontend/components/agent-chat-widget.tsx`
*   **Tech:** Next.js, React, Native WebSockets.
*   **Role:**
    *   A floating, non-intrusive chat widget added to `app/page.tsx`.
    *   Connects directly to the Agent Server (Port 8005).
    *   Handles real-time message streaming.

### D. Infrastructure
*   **`Justfile`**: Unified command runner.
    *   `just agent-server`: Starts the Agent.
    *   `just frontend-dev`: Starts the Frontend.
*   **Shell Scripts**: `run_server.sh` and `run_agent.sh` for easy startup handling PYTHONPATH dependencies.

---

## 2. Current Workflow (Guest Mode)

The system currently operates in **Guest Mode**:
1.  **User Visits Site**: A unique `session_id` is generated by the frontend.
2.  **Chat Initiated**: connect to `ws://.../ws/chat/{session_id}`.
3.  **Agent Interaction**:
    *   The Agent treats the `session_id` as a temporary User ID.
    *   It can parse resumes and generate PDFs *within that session*.
    *   ** Limitation**: It does not yet connect to the persistent `users` table login. Re-loading the page creates a fresh session.

---

## 3. roadmap & Next Steps

### Phase 3: Authentication & Persistence (Immediate Next Step)
The current gap is linking the Agent to the logged-in user.
-   [ ] **Pass User Token**: Send the Frontend Auth Token (JWT/Session) via the WebSocket handshake.
-   [ ] **Validate in Agent**: Agent Server validates token and extracts the *real* `user_id`.
-   [ ] **Persistent Memory**: Swap `InMemorySessionService` for a database-backed session store so chat history survives refreshes.

### Phase 4: Advanced Features
-   [ ] **Resume Tailoring**: Implement logic to take a specific Job Description and re-write the resume summary/bullets to match it.
-   [ ] **Missing Skills Analysis**: Agent scans the resume vs. JD and suggests missing keywords.
-   [ ] **Theme Selector**: Allow user to ask "Change theme to Modern" via chat.

### Phase 5: Deployment
-   [ ] **Dockerize**: Create `Dockerfile` for the Agent Service.
-   [ ] **Orchestration**: specific `docker-compose.yml` to run Backend API, Agent API, and Frontend together.
